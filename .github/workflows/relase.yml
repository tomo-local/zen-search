name: Release

on:
  workflow_dispatch:
    inputs:
      versionType:
        description: "Version type (major, minor, patch)"
        required: true
        default: "patch"
        type: choice
        options:
          - major
          - minor
          - patch

jobs:
  create-release-draft:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Create Release
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const versionType = core.getInput('versionType');
            const { data: latestRelease } = await github.rest.repos.getLatestRelease({
              owner: context.repo.owner,
              repo: context.repo.repo,
            });

            const semver = require('semver');
            const newVersion = semver.inc(latestRelease.tag_name, versionType);

            await github.rest.repos.createRelease({
              owner: context.repo.owner,
              repo: context.repo.repo,
              tag_name: newVersion,
              name: `v${newVersion}`,
              body: `Release v${newVersion}`,
              draft: true,
              prerelease: false,
            });
